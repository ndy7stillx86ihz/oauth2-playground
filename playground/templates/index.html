{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-screen">
    <!-- Left Panel - Forms -->
    <div class="space-y-6 overflow-y-auto pr-4">
        <!-- Educational Tabs -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6">
                    <button id="practice-tab" onclick="switchTab('practice')"
                            class="py-4 px-1 border-b-2 border-green-500 text-green-600 font-medium text-sm">
                        <i class="fas fa-code mr-2"></i>Practice
                    </button>
                    <button id="theory-tab" onclick="switchTab('theory')"
                            class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                        <i class="fas fa-book mr-2"></i>Theory
                    </button>
                </nav>
            </div>

            <!-- Theory Content -->
            <div id="theory-content" class="p-6 hidden">
                <h1 class="text-2xl font-bold text-center mb-6">OAuth2 & OpenID Connect Guide</h1>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h2 class="text-lg font-semibold mb-3">What is OAuth2?</h2>
                        <p class="text-gray-600 mb-4">OAuth2 is an authorization framework that enables applications to obtain limited access to user accounts.</p>

                        <h3 class="font-medium mb-2">Grant Types:</h3>
                        <ul class="space-y-1 text-sm text-gray-600">
                            <li><strong>Authorization Code:</strong> Most secure flow for web applications</li>
                            <li><strong>Authorization Code + PKCE:</strong> Enhanced security for public clients</li>
                            <li><strong>Implicit:</strong> Simplified flow for browser-based apps (deprecated)</li>
                            <li><strong>Client Credentials:</strong> Machine-to-machine authentication</li>
                            <li><strong>Password:</strong> Direct username/password exchange (not recommended)</li>
                            <li><strong>Refresh Token:</strong> Obtain new access tokens</li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold mb-3">How to use this Playground</h2>
                        <ol class="space-y-2 text-sm text-gray-600">
                            <li><strong>1. Auto-Discovery:</strong> Enter your OAuth provider's base URL</li>
                            <li><strong>2. Configure:</strong> Fill in your client credentials and select a grant type</li>
                            <li><strong>3. Test:</strong> Execute the OAuth flow and examine the results</li>
                            <li><strong>4. Learn:</strong> Inspect tokens, understand the flow, and experiment safely</li>
                        </ol>

                        <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
                            <p class="text-sm text-blue-800"><strong>Security Note:</strong> This playground is for educational purposes. Never use production credentials.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice Content -->
            <div id="practice-content" class="p-6">
                <h1 class="text-2xl font-bold text-center mb-6">OAuth2 Playground</h1>

                <!-- Auto-Discovery Section -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg border">
                    <h2 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fas fa-search mr-2 text-green-600"></i>Auto-Discovery
                    </h2>
                    <div class="flex gap-2">
                        <input type="url" id="discovery-url" placeholder="https://example.com"
                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        <button id="discover-btn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                            <i class="fas fa-search mr-1"></i>Discover
                        </button>
                    </div>
                    <div id="discovery-status" class="mt-2"></div>
                </div>

                <!-- Main OAuth2 Form -->
                {% csrf_token %}
                <form id="oauth2-form" class="space-y-6">
                    <div class="bg-white p-6 rounded-lg border border-gray-200">
                        <h2 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-cog mr-2 text-green-600"></i>OAuth2 Configuration
                        </h2>

                        <!-- Base Configuration -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Base URL</label>
                                <input type="url" id="base-url" name="base_url" placeholder="https://oauth-provider.com"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Authorization Endpoint</label>
                                    <input type="url" id="authorization-endpoint" name="authorization_endpoint"
                                           placeholder="https://oauth-provider.com/oauth/authorize"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Token Endpoint</label>
                                    <input type="url" id="token-endpoint" name="token_endpoint"
                                           placeholder="https://oauth-provider.com/oauth/token"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client ID</label>
                                <input type="text" id="client-id" name="client_id" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Grant Type</label>
                                <select id="grant-type" name="grant_type"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    <option value="">Select Grant Type</option>
                                    {% for value, label in grant_types %}
                                    <option value="{{ value }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Dynamic Fields -->
                        <!-- Authorization Code with PKCE -->
                        <div id="fields-authorization_code_with_pkce" class="hidden mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                            <h3 class="text-md font-semibold mb-4">Authorization Code with PKCE</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                    <input type="text" name="scope" placeholder="openid profile email"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Redirect URI</label>
                                    <input type="url" name="redirect_uri" placeholder="http://localhost:8000/auth-code/"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Code Verifier</label>
                                    <input type="text" id="code-verifier" name="code_verifier" placeholder="Enter or generate code verifier"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    <button type="button" id="generate-verifier" class="mt-1 text-sm text-green-600 hover:text-green-700">
                                        Generate Random
                                    </button>
                                </div>

                                <!-- Code challenge to the left of method as requested -->
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Code Challenge (Auto-generated)</label>
                                        <input type="text" id="code-challenge" name="code_challenge" readonly
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Challenge Method</label>
                                        <select id="challenge-method" name="code_challenge_method"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                            <option value="S256" selected>SHA256</option>
                                            <option value="plain">Plain</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Completed all remaining grant type fields with Tailwind styling -->
                        <!-- Authorization Code -->
                        <div id="fields-authorization_code" class="hidden mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h3 class="text-md font-semibold mb-4">Authorization Code</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                    <input type="text" name="scope" placeholder="openid profile email"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Redirect URI</label>
                                    <input type="url" name="redirect_uri" placeholder="http://localhost:8000/auth-code/"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>
                        </div>

                        <!-- Implicit -->
                        <div id="fields-implicit" class="hidden mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <h3 class="text-md font-semibold mb-4">Implicit Grant</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                    <input type="text" name="scope" placeholder="openid profile email"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Redirect URI</label>
                                    <input type="url" name="redirect_uri" placeholder="http://localhost:8000/auth-code/"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>
                        </div>

                        <!-- Password -->
                        <div id="fields-password" class="hidden mt-6 p-4 bg-red-50 rounded-lg border border-red-200">
                            <h3 class="text-md font-semibold mb-4">Resource Owner Password</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                    <input type="text" name="scope" placeholder="openid profile email"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                        <input type="text" name="username"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                        <input type="password" name="password"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Client Secret</label>
                                    <input type="password" name="client_secret"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>
                        </div>

                        <!-- Client Credentials -->
                        <div id="fields-client_credentials" class="hidden mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200">
                            <h3 class="text-md font-semibold mb-4">Client Credentials</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                    <input type="text" name="scope" placeholder="api:read api:write"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Client Secret</label>
                                    <input type="password" name="client_secret"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>
                        </div>

                        <!-- Refresh Token -->
                        <div id="fields-refresh_token" class="hidden mt-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                            <h3 class="text-md font-semibold mb-4">Refresh Token</h3>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Refresh Token URL</label>
                                    <input type="url" id="refresh-token-url" name="refresh_token_url" placeholder="https://oauth-provider.com/oauth/token"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Access Token</label>
                                    <input type="text" name="access_token"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Refresh Token</label>
                                    <input type="text" name="refresh_token"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <button type="submit" class="w-full px-4 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors font-medium">
                                <i class="fas fa-play mr-2"></i>Start OAuth2 Flow
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Right Panel - Results -->
    <div id="results-panel" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 overflow-y-auto">
        <h2 class="text-lg font-semibold mb-4 flex items-center">
            <i class="fas fa-terminal mr-2 text-green-600"></i>Results
        </h2>
        <div id="results-content" class="text-gray-500 text-center py-12">
            <i class="fas fa-arrow-left text-4xl mb-4"></i>
            <p>Configure and run an OAuth2 flow to see results here</p>
        </div>
    </div>
</div>
{% endblock %}
